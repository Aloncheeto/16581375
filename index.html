<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }
        
        body {
            width: 100vw;
            height: 25600vw;
            display: block;
        }
        
        .bit {
            width: calc(100vw / 256);
            height: calc(100vw / 256);
            float: left;
        }
    </style>
</head>

<body>
</body>

<script>
    const container = document.querySelector('.container');
    const bitSize = 10;
    const totalElements = 256 * 256 * 256;
    const elementsPerRow = Math.floor(window.innerWidth / bitSize);
    const totalRows = Math.ceil(totalElements / elementsPerRow);
    const visibleRows = Math.ceil(window.innerHeight / bitSize);
    const bufferRows = 5;
    const totalVisibleRows = visibleRows + bufferRows * 2;

    let red = 0, green = 0, blue = 0;
    let elements = [];

    const calcColor = function(i) {
        const colorIndex = i;
        const b = colorIndex % 256;
        const g = Math.floor(colorIndex / 256) % 256;
        const r = Math.floor(colorIndex / (256 * 256));
        return `rgb(${r}, ${g}, ${b})`;
    }

    const renderRows = function(startRow, endRow) {
        const fragment = document.createDocumentFragment();

        for (let row = startRow; row <= endRow; row++) {
            for (let col = 0; col < elementsPerRow; col++) {
                const index = row * elementsPerRow + col;
                if (index >= totalElements) break;

                const bit = document.createElement('div');
                bit.classList.add('bit');
                bit.style.backgroundColor = calcColor(index);
                bit.style.top = `${row * bitSize}px`;
                bit.style.left = `${col * bitSize}px`;
                fragment.appendChild(bit);
            }
        }

        container.appendChild(fragment);
    }

    const onScroll = function() {
        const scrollTop = container.scrollTop;
        const startRow = Math.floor(scrollTop / bitSize) - bufferRows;
        const endRow = startRow + totalVisibleRows;

        container.innerHTML = '';
        renderRows(Math.max(startRow, 0), Math.min(endRow, totalRows - 1));
    }

    container.style.height = `${totalRows * bitSize}px`;

    window.addEventListener('scroll', onScroll);
    renderRows(0, totalVisibleRows);
</script>
</html>
